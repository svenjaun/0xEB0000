var get=function(e,t,n){var i=new XMLHttpRequest;if(i.open("GET",e,!0),console.log(t),void 0!==t.data.headers)for(var r of t.data.headers)i.setRequestHeader(Object.keys(r)[0],r[Object.keys(r).pop()]);i.onreadystatechange=function(){4==i.readyState&&n(JSON.parse(i.responseText),i.status)},i.send(null)};class RestForm{constructor(e){if(this.xhr=new XMLHttpRequest,e.hasOwnProperty("methods")&&Array.isArray(e.methods))for(let t of e.methods)this.methods=[],this.methods.push(t);e.hasOwnProperty("isArray")&&(this.isArray=e.isArray),e.hasOwnProperty("url")&&(this.url=e.url)}save(e){}update(e){}get(e,t,n){this.xhr.open("GET",this.url,!1,t||void 0,n||void 0),this.xhr.send(),this.xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&console.error(xhr.responseText)}}getOne(e){}}class NailsDirectives{constructor(){this.directives=["if","form","for","test"]}form(e,t,n){"text"===e.getAttribute("type")&&n.data[t]!==e.value&&(n.data[t]=e.value),e.addEventListener("input",function(){n.data[t]!==e.value&&(n.data[t]=e.value)})}for(element,statemenet,state){var engine=new RenderingEngine(state);function interpolateCustomElement(e,t,n){var i=e.innerHTML,r=engine.getInterpolationsFortextContent(i);for(var s of r){var a=engine.stripAndTrimInterpolation(s);t.hasOwnProperty(a.split(".")[1])&&(i=i.replace(s,engine.sanitize(t[a.split(".")[1]])))}e.innerHTML=i}element.style.display="none";var descriptor=statemenet.split(" ")[1],arr=statemenet.split(" ")[3],refArray=eval("state.data."+arr);if(null!=refArray){var parent=element.parentNode;for(var i of(parent.childNodes.length>5&&(console.log("State change?"),console.log(parent.childNodes.length)),refArray)){var child=document.createElement(element.nodeName);for(var i of(child.innerHTML=element.innerHTML,interpolateCustomElement(child,i,descriptor),parent.appendChild(child),element.attributes))"n-for"!==i.name&&"style"!==i.name&&child.setAttribute(i.name,i.value);engine.executeDirectivesOnElement(child,!0)}}}if(element,statement,state){var reversed=!1;"!"===statement[0]&&(statement=statement.substring(1),reversed=!0),state.data.hasOwnProperty(statement)?reversed?eval(state.data[statement])?element.style.display="none":element.style.display="block":eval(state.data[statement])?element.style.display="block":element.style.display="none":console.warn("statement: "+statement+" not found in context")}}class RenderingEngine{constructor(e){null==e&&console.log("Engine was initialized without a state"),this.state=e,this.directives=new NailsDirectives}insert(e,t,n){return e>0?n.substring(0,e)+t+n.substring(e,n.length):t+n}setTitle(){void 0===this.state.data.title&&null!==this.state.data.title||(document.title=this.state.data.title)}elementCanGetAttribute(e){return"getAttribute"in e}isNForActivated(e){return!!this.elementCanGetAttribute(e)&&null!==e.getAttribute("n-for")}disableInterpolationForVariableNameOnElement(e,t){if(void 0!==e&&void 0!==t){for(var n of this.state.disabledElements)if(n[0]==e&&n[1]==t)return;this.state.disabledElements.push([e,t])}}getElementDerrivedObject(e){return"object"}getElementDerrivedProperty(e){return"property"}getForArrayByStatement(e){return e.split(" ").last}isForAttribute(e){return"getAttribute"in(e=e[0])&&null!==e.getAttribute("n-for")}isActiveElement(e){return this.getElementDirectives(e).length>0}removePrefix(e){return e.substring(2)}prefixDiretive(e){return"n-"+e}getElementDirectives(e){if(void 0===e)return[];var t=[];for(var n of this.directives.directives)n=this.prefixDiretive(n),"hasAttribute"in e&&e.hasAttribute(n)&&t.push(n);return t}indexElement(e){this.state.disableElementIfNeeded(e);var t=[];for(var n of e.childNodes){var i=this.indexElement(n);t.push.apply(t,i)}return this.isActiveElement(e)&&t.push(e),t}getElementAttributeForDirective(e,t){return t=this.prefixDiretive(t),e.hasAttribute(t)?e.getAttribute(t):(console.warn("directive: "+t+" not found on element: "+e),"")}executeDirectivesOnElement(e,t){var n=this.getElementDirectives(e);for(var i of n)if((i=this.removePrefix(i))in this.directives){this.directives[i](e,this.getElementAttributeForDirective(e,i),this.state);n=this.getElementDirectives(e);if(t)for(var r of n)this.state.addActiveDirectiveElement(r,e.getAttribute(r),e)}else console.warn("not found directive: "+i)}stripAndTrimNForInterpolation(e){return e=(e=(e=e.replace("[[[","")).replace("]]]","")).trim()}getNForInterpolations(e){var t=[],n=(e=e.trim()).match(/\[\[\[(( +)?\w+.?\w+( +)?)\]\]\]/g);if(null===n)return t;for(var i of n)t.push(i);return t}getNForInterpolation(e){return(e=e.trim()).match(/\[\[\[(( +)?\w+.?\w+( +)?)\]\]\]/g)?e=this.stripAndTrimNForInterpolation(e):(console.warn("Not found interpolation in submitted value: "+e),e)}getValueOfInterpolation(e){return e=e.trim(),e.match(/{{(( +)?\w+.?\w+( +)?)}}/g)?(e=this.stripAndTrimInterpolation(e),e=e.trim(),e.split(".").length>1?"[[["+e+"]]]":this.state.data[e]):(console.warn("Not found interpolation in submitted value: "+e),e)}removeWhiteSpaceFromString(e){return e.replace(/\s/g,"")}stripAndTrimInterpolation(e){return void 0===e||null===typeof e?e:e=(e=(e=e.replace("{{","")).replace("}}","")).trim()}getInterpolationsFortextContent(e){var t=[];if(null==e)return t;var n=e.match(/{{(( +)?\w+.?\w+( +)?)}}/g);if(null===n)return[];for(var i of n)t.push(i);return t}getObjectReferenceByInterpolationName(e){return e=this.stripAndTrimInterpolation(e),this.state.data[e]}interpolateOnTextWithState(e,t){}getContentOfNodeIfTextNodeExists(e){if(3===e.nodeType)return e.nodeValue;if(0===e.childNodes.length)return null;if(this.nodeHasTextNodeAsADirectChild(e))for(var t of e.childNodes)if(null!==this.getContentOfNodeIfTextNodeExists(t))return this.getContentOfNodeIfTextNodeExists(t)}setContentOfTextNode(e,t){return 3!==e.nodeType?(console.error("setContentOfTextNode... this implies that you *HAVE* to provide nothing else than a textNode as argument."),!1):(e.nodeValue=t,!0)}updateInterpolatedElement(e,t){this.executeDirectivesOnElement(e,!1);var n=this.getInterpolationsFortextContent(t);if(0!==n.length){var i=t;for(var r of n){var s=this.getValueOfInterpolation(r);this.isElementDisabled(this.stripAndTrimInterpolation(r),e)||(i=i.replace(r,s))}e.textContent=i}}isDescendant(e,t){for(var n=t.parentNode;null!=n;){if(n==e)return!0;n=n.parentNode}return!1}isElementDisabled(e,t){for(var n of this.state.disabledElements){if((this.isDescendant(t,n[1])||this.isDescendant(n[1],t))&&e.includes(n[0]))return!0;if(n[0]===e&&n[1]===t)return!0}return!1}interpolateElement(e,t){for(var n of t){this.state.disableElementIfNeeded(e);var i=this.getValueOfInterpolation(n);if(!this.isElementDisabled(this.stripAndTrimInterpolation(n).trim(),e)){var r=e.textContent||e.textContent;r=r.replace(n,i),"textContent"in e?e.textContent=r:"textContent"in e&&(e.textContent=r)}}return e}nodeHasTextNodeAsAChild(e){return 3===e.nodeType||0!==e.childNodes.length&&this.nodeHasTextNodeAsAChild(e)}nodeHasTextNodeAsADirectChild(e){for(var t of e.childNodes)if(3===t.nodeType)return!0;return!1}isTextNode(e){return 3===e.nodeType}sanitize(e){if("string"!=typeof e)return e;var t=document.createElement("div");return t.textContent=e,t.innerHTML}executeInerpolationsOnElement(e){for(var t of e.childNodes)this.executeInerpolationsOnElement(t);var n=this.getInterpolationsFortextContent(e.nodeValue);if(this.isTextNode(e)){if(0===n.length)return;if(3!==e.nodeType)return;for(var i of n)this.state.addActiveElement(e,this.getObjectReferenceByInterpolationName(i),e.nodeValue,i);this.interpolateElement(e,n)}else{if(!this.isNForActivated(e))return;i="{{"+e.getAttribute("n-for").split(" ")[3]+"}}";this.state.addActiveElement(e,e.getAttribute("n-for").split(" ")[3],null,i)}}}class State{getInstance(){return null===this.instance&&(this.instance=new State),this.instance}constructor(){this.data={},this.activeElements=[],this.activeDirectiveElements=[],this.engine=new RenderingEngine(this),this.disabledElements=[]}addActiveDirectiveElement(e,t,n){for(var i of this.activeDirectiveElements)if(i.key===e&&i.statement===t&&i.element===n)return void console.warn("refusing to insert element");this.activeDirectiveElements.push({key:e,statement:t,element:n})}updateElementRefByObject(e,t){for(var n of this.activeElements)n[1]===e&&(n[0]=t)}addActiveElement(e,t,n,i){this.activeElements.push([e,t,n,i])}findElementByRef(e){for(var t of this.activeElements)if(t[0]===e)return t}getHtmlReferenceOfStateElement(e){return e[0]}stripAndTrimInterpolation(e){return"string"!=typeof e?e:e=(e=(e=e.replace("{{","")).replace("}}","")).trim()}disableElementIfNeeded(e){if("getAttribute"in e){var t=e.getAttribute("n-for");if(null===t)return;var n=t.split(" ")[1];this.engine.disableInterpolationForVariableNameOnElement(n,e)}}findElementsByObject(e,t){var n=[];for(var i of this.activeElements)this.stripAndTrimInterpolation(i[3])===t&&n.push(i);for(var i of this.activeDirectiveElements)t=t.replace("!",""),i.statement=i.statement.replace("!",""),this.stripAndTrimInterpolation(i.statement)===t&&n.push(i);return n}}class Nails{constructor(e){void 0!==e.methods.onInit&&e.methods.onInit(),this.state=new State,console.log("NailsJS Created with constructor object: "+JSON.stringify(e)),e.hasOwnProperty("el")?this.state.element=e.el:console.error("NailsJS cannot be initalized, because no element was specified"),e.hasOwnProperty("data")&&(this.state.data=e.data),e.hasOwnProperty("methods")&&(this.state.methods=e.methods),this.engine=new RenderingEngine(this.state),this.setUpProxy(),this.indexDOM(),this.engine.setTitle(),this.state.methods.getState=function(){return this.state},void 0!==this.state.methods.onMounted&&this.state.methods.onMounted(this.state)}notifyDOM(e,t,n){var i=this.state.findElementsByObject(e,t);if(i!==[]&&0!==i.length){for(var r of i)if(r.hasOwnProperty("key"))this.engine.executeDirectivesOnElement(r.element,!1);else{this.state.getHtmlReferenceOfStateElement(r);this.engine.updateInterpolatedElement(r[0],r[2]),this.engine.executeDirectivesOnElement(r,!1)}return!0}}indexDOM(){if(void 0!==this.state.element){var e=null;if(this.state.element.startsWith("#")){var t=this.state.element.substr(1);e=document.getElementById(t)}else e=document.getElementsByTagName(this.state.element);if(null==e)return void console.error("No element with selector: "+this.state.element+" has been found");if(e instanceof HTMLCollection&&e.length>1)return void console.error("Multiple choices, try using id if the element tag is not unique. Your Selector was: "+this.state.element);if(e instanceof HTMLCollection&&0===e.length)return void console.error("No element with selector: "+this.state.element+" has been found");e instanceof HTMLCollection&&(e=e[0]);var n=this.engine.indexElement(e);for(var i of n)this.engine.executeDirectivesOnElement(i,!0);this.engine.executeInerpolationsOnElement(e)}}setUpProxy(){var e={state:this.state,notifyDom:this.notifyDOM,engine:this.engine,get:function(e,t,n){return e[t]},set(e,t,n){return e[t]=n,this.notifyDom(e,t),!0}},t=new Proxy(this.state.data,e);this.state.data=t}}